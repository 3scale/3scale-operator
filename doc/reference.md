# 3scale Operator

## 3scale API Management installation functionality

The following Custom Resources are provided:

`APIManager`

One APIManager custom resource per project is allowed.

This resource is the resource used to deploy a 3scale API Management solution.

### APIManager

| **Field** | **json field**| **Type** | **Info** |
| --- | --- | --- | --- |
| Spec | `spec` | [APIManagerSpec](#APIManagerSpec) | The specfication for APIManager custom resource |
| Status | `status` | [APIManagerStatus](#APIManagerStatus) | The status for the custom resource |

#### APIManagerSpec

| **Field** | **json field**| **Type** | **Info** | **Required** |
| --- | --- | --- | --- | --- |
| WildcardDomain | `wildcardDomain` | string | Root domain for the wildcard routes. Eg. example.com will generate 3scale-admin.example.com. | Yes |
| AmpRelease | `ampRelease` | string | 3Scale API Management solution release version | Yes |
| AppLabel | `appLabel` | string | The value of the `app` label that will be applied to the API management solution | No |
| TenantName | `tenantName` | string | Tenant name under the root that Admin UI will be available with -admin suffix. | No |
| WildcardPolicy | `wildcardPolicy` | string | Use `Subdomain` to create a wildcard route for apicast wildcard router. By default is `None` | No |
| TODO add pending fields | | | | |

#### APIManagerStatus

| **Field** | **json field**| **Type** | **Info** |
| --- | --- | --- | --- |
| TODO add pending fields | --- | --- | --- |

### APIManager Secrets

Additionally, if desired, several sensitive APIManager configuration options
can be controlled by pre-creating some Kubernetes secrets before deploying the
APIManager Custom Resource.

The available configurable secrets are:

#### apicast-redis

| **Field** | **Description** | **Default value** |
| --- | --- | --- |
| PRODUCTION_URL | TODO | `redis://system-redis:6379/1` |
| STAGING_URL | TODO | `redis://system-redis:6379/2` |

#### backend-internal-api

| **Field** | **Description** | **Default value** |
| --- | --- | --- |
| username | TODO | `3scale_api_user` |
| password | TODO | Autogenerated value |

#### backend-listener

| **Field** | **Description** | **Default value** |
| --- | --- | --- |
| service_endpoint | TODO | `http://backend-listener:3000` |
| route_endpoint | TODO | `https://backend-<tenantName>.<wildcardDomain>` |

#### backend-redis

| **Field** | **Description** | **Default value** |
| --- | --- | --- |
| REDIS_STORAGE_URL | TODO | `redis://backend-redis:6379/0` |
| REDIS_STORAGE_SENTINEL_ROLE | TODO | `""` |
| REDIS_STORAGE_SENTINEL_HOSTS | TODO | `""` |
| REDIS_QUEUES_URL | TODO | `redis://backend-redis:6379/1` |
| REDIS_QUEUES_SENTINEL_ROLE | TODO | `""` |
| REDIS_QUEUES_SENTINEL_HOSTS | TODO | `""` |

#### system-app

| **Field** | **Description** | **Default value** |
| --- | --- | --- |
| SECRET_KEY_BASE | TODO | Autogenerated value |

#### system-database

| **Field** | **Description** | **Default value** |
| --- | --- | --- |
| URL | TODO | `mysql2://root:<rootDatabasePassword>@system-mysql/<databaseName>` |

#### system-events-hook

| **Field** | **Description** | **Default value** |
| --- | --- | --- |
| URL | TODO | `http://system-master:3000/master/events/import` |
| PASSWORD | TODO | Autogenerated value |

#### system-master-apicast

| **Field** | **Description** | **Default value** |
| --- | --- | --- |
| ACCESS_TOKEN | TODO | Autogenerated value |
| BASE_URL | TODO | `http://<ACCESS_TOKEN>@system-master:3000` |
| PROXY_CONFIGS_ENDPOINT | TODO | `http://<ACCESS_TOKEN>@system-master:3000/master/api/proxy/configs` |

#### system-memcache

| **Field** | **Description** | **Default value** |
| --- | --- | --- |
| SERVERS | TODO | `system-memcache:11211` |

#### system-recaptcha

| **Field** | **Description** | **Default value** |
| --- | --- | --- |
| PUBLIC_KEY | TODO | `""` |
| SECRET_KEY | TODO | `""` |

#### system-redis

| **Field** | **Description** | **Default value** |
| --- | --- | --- |
| URL | TODO | `redis://system-redis:6379/1` |

#### system-seed

| **Field** | **Description** | **Default value** |
| --- | --- | --- |
| MASTER_USER | TODO | `master` |
| MASTER_PASSWORD | TODO | Autogenerated value |
| MASTER_ACCESS_TOKEN | TODO | Autogenerated value |
| MASTER_DOMAIN | TODO | `master` |
| ADMIN_USER | TODO | `admin` |
| ADMIN_PASSWORD | TODO | Autogenerated value |
| ADMIN_ACCESS_TOKEN | TODO | Autogenerated value |
| TENANT_NAME | TODO | `<tenantName>` |

#### zync

| **Field** | **Description** | **Default value** |
| --- | --- | --- |
| DATABASE_URL | TODO | `postgresql://zync:<ZYNC_DATABASE_PASSWORD>@zync-database:5432/zync_production` |
| SECRET_KEY_BASE | TODO | Autogenerated value |
| ZYNC_AUTHENTICATION_TOKEN | TODO | Autogenerated value |
| ZYNC_DATABASE_PASSWORD | TODO | Autogenerated value |

## Capabilities functionality

TODO
